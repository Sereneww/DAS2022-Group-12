---
title: "groupwork2"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r pacakages}
library(ggplot2)
library(qcc)
library(arm)
library(jtools)
library(broom)
library(ggstance)
```

## 1.Description of the problem

(Describe the data set, the question, the methods used.  ...)

```{r loading data}
data12 <-read.csv("/Users/serene/Desktop/seme2/das/dataset12.csv")
data12<-na.omit(data12)

```

## 2.Descriptive statistics

2.1  Descriptive statistics for independent variables

```{r boxplot for Independent variables}
unique(data12$animal_type)
p1 <- ggplot(data=data12,aes(x=animal_type,y=time_at_shelter))
p1+geom_boxplot()
p1+geom_boxplot(aes(fill=animal_type))

unique(data12$intake_type)
p2 <- ggplot(data=data12,aes(x=intake_type,y=time_at_shelter))
p2+geom_boxplot()
p2+geom_boxplot(aes(fill=intake_type))

unique(data12$outcome_type)
p3 <- ggplot(data=data12,aes(x=outcome_type,y=time_at_shelter))
p3+geom_boxplot()
p3+geom_boxplot(aes(fill=outcome_type))

unique(data12$chip_status)
p4 <- ggplot(data=data12,aes(x=chip_status,y=time_at_shelter))
p4+geom_boxplot()
p4+geom_boxplot(aes(fill=chip_status))

unique(data12$year)
data12$year <- as.character(data12$year)
p5 <- ggplot(data=data12,aes(x=year,y=time_at_shelter))
p5+geom_boxplot()
p5+geom_boxplot(aes(fill=year))
```

(Box line diagram description)

2.2 Determining the distribution of response variables

```{r}
summary(data12$time_at_shelter)

ggplot(data=data12,aes(x=time_at_shelter))+
  geom_histogram(aes(y=..density..),colour="black", fill="white",breaks=seq(0,80,6))+
  xlim(0,80)+
  geom_density(alpha=.2, fill="red")
```

The data was found not to be in the form of a bell curve like a normal distribution.
Next, test the mean and variance
```{r}
mean(data12$time_at_shelter)
var(data12$time_at_shelter)
```
By examining the mean and variance, it was found that the variance was much larger than the mean, indicating that there would be overdispersion in the model

## 3.Model selection

(Explain the glm model, the Poisson family of distributions, and why we chose the Poisson distribution for the glm regression.)

## 4.Building a glm Poisson regression model

```{r poison model}
poimodel <- glm(time_at_shelter ~.,
                data = data12,family = poisson)
summary(poimodel)
```
Exponentiated to better explain the model parameters.
```{r}
exp(coef(poimodel))
```
The problem of excessive departure from the potential needs attention in #Poisson regression. The mean and variance are equal in a Poisson distribution.
Such a problem may arise in Poisson regression when the actual distribution of the observed response variable does not satisfy this.

## 5.Model testing and Poisson-like models

The general cause of this problem is the lack of explanatory variables. We can use the qcc package for Poisson models to test for overdiscrepancy.
```{r}
qcc.overdispersion.test(data12$time_at_shelter, type = "poisson")
```
p-values are 0, there is an excessive departure from the potential and a Poisson-like model is chosen for modelling

Only significant variables and variables of substance are retained here

```{r quasipoisson model}

fit3 <- glm(time_at_shelter ~ intake_type + outcome_type + chip_status, family = quasipoisson(), data = data12)
summary(fit3)
exp(coef(fit3))
```

## 6.Model comparison and parameter interpretation

To compare the Poisson-like distribution model with the Poisson distribution model, while making the original Poisson distribution model

```{r poisson model2}
fit2 <- glm(time_at_shelter ~ intake_type + outcome_type + chip_status, family = poisson(), data = data12)
summary(fit2)
exp(coef(fit2))
```


```{r comparison for 2 models}
coef1 = coef(fit2)
coef2 = coef(fit3)
se.coef1 = se.coef(fit2)
se.coef2 = se.coef(fit3)
models.both <- cbind(coef1,se.coef1,coef2,se.coef2,exponent = exp(coef1))
models.both
```

Comparing the results of the above two model parameters shows that the parameter estimates are consistent while the standard errors are different.
In the case of over-discrepancy, the t-value/p-value of the Poisson-like results should be used to test the significance of the independent variables.

(Explanation of model parameters)

## 7.Visualisation of model results
```{r}
plot_coefs(fit3)
plot_summs(fit2,fit3,scale=T,exp=T)
```

The regression coefficients are compared with the same values but the standard errors are greater for the Poisson-like distribution model.

## 8.Summary

(Response to questions, summary of results.)

## 9.Future work

The problem of too many zero values in the data, consider the zero-inflated Poisson distribution model.

## 10.Reference

Chen Qiang. Advanced econometrics and Stata applications [M]. Higher Education Press, 2014.

Xu Xin. (2020). A generalization of the zero-inflated generalized Poisson model and its application to actuarial calculations. Mathematical Statistics and Management

Wilson, P. 2015. The misuse of the Vuong test for non-nested models to test for zero-inflation. Economics Letters 127:51-53. -Link-, -PDF-

Van den Broek, J. (1995). A Score Test for Zero Inflation in a Poisson Distribution. Biometrics, 51(2), 738-743. -Link-, -PDF-

Vuong, Q. H. (1989). Likelihood Ratio Tests for Model Selection and Non-Nested Hypotheses. Econometrica, 57(2), 307â€“333. -Link-, -PDF-
